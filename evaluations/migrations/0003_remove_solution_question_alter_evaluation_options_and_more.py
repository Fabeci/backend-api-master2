# Generated by Django 5.1.6 on 2026-01-06 17:35

import django.core.validators
import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('evaluations', '0002_initial'),
        ('users', '0023_remove_apprenant_classe'),
    ]

    operations = [
        migrations.RemoveField(
            model_name='solution',
            name='question',
        ),
        migrations.AlterModelOptions(
            name='evaluation',
            options={'ordering': ['-date_creation']},
        ),
        migrations.AlterModelOptions(
            name='question',
            options={'ordering': ['ordre']},
        ),
        migrations.AlterModelOptions(
            name='quiz',
            options={'ordering': ['-date_creation'], 'verbose_name_plural': 'Quizzes'},
        ),
        migrations.AlterModelOptions(
            name='reponse',
            options={'ordering': ['ordre'], 'verbose_name': 'Réponse prédéfinie', 'verbose_name_plural': 'Réponses prédéfinies'},
        ),
        migrations.RenameField(
            model_name='evaluation',
            old_name='date_passage',
            new_name='date_creation',
        ),
        migrations.RenameField(
            model_name='question',
            old_name='texte',
            new_name='enonce_texte',
        ),
        migrations.RemoveField(
            model_name='reponse',
            name='est_choix_multiple',
        ),
        migrations.RemoveField(
            model_name='reponse',
            name='est_choix_unique',
        ),
        migrations.AddField(
            model_name='evaluation',
            name='consigne_texte',
            field=models.TextField(blank=True, help_text="Consigne de l'évaluation (pour type simple)"),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='date_debut',
            field=models.DateTimeField(blank=True, help_text='Date de début de disponibilité', null=True),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='date_fin',
            field=models.DateTimeField(blank=True, help_text='Date de fin de disponibilité', null=True),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='date_modification',
            field=models.DateTimeField(auto_now=True),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='duree_minutes',
            field=models.PositiveIntegerField(blank=True, help_text='Durée limite en minutes (optionnel)', null=True),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='enseignant',
            field=models.ForeignKey(default=1, on_delete=django.db.models.deletion.CASCADE, related_name='evaluations_creees', to='users.formateur'),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='est_publiee',
            field=models.BooleanField(default=False),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='fichier_sujet',
            field=models.FileField(blank=True, help_text='Fichier sujet (pour type simple)', null=True, upload_to='evaluations/sujets/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'docx', 'doc', 'txt', 'jpg', 'jpeg', 'png'])]),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='titre',
            field=models.CharField(max_length=255, null=True),
        ),
        migrations.AddField(
            model_name='evaluation',
            name='type_evaluation',
            field=models.CharField(choices=[('simple', 'Évaluation simple (texte ou fichier unique)'), ('structuree', 'Évaluation structurée (plusieurs questions)')], default='structuree', max_length=20),
        ),
        migrations.AddField(
            model_name='question',
            name='fichier_enonce',
            field=models.FileField(blank=True, help_text="Fichier annexe à l'énoncé (image, document...)", null=True, upload_to='questions/enonces/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'docx', 'doc', 'jpg', 'jpeg', 'png', 'gif'])]),
        ),
        migrations.AddField(
            model_name='question',
            name='indication_reponse',
            field=models.TextField(blank=True, help_text="Indication pour guider l'apprenant (éléments attendus, format...)"),
        ),
        migrations.AddField(
            model_name='question',
            name='mode_correction',
            field=models.CharField(choices=[('automatique', 'Correction automatique'), ('manuelle', 'Correction manuelle')], default='automatique', max_length=20),
        ),
        migrations.AddField(
            model_name='question',
            name='ordre',
            field=models.PositiveIntegerField(default=0, help_text="Ordre d'affichage"),
        ),
        migrations.AddField(
            model_name='question',
            name='points',
            field=models.FloatField(default=1.0, help_text='Nombre de points pour cette question'),
        ),
        migrations.AddField(
            model_name='quiz',
            name='date_modification',
            field=models.DateTimeField(auto_now=True),
        ),
        migrations.AddField(
            model_name='quiz',
            name='description',
            field=models.TextField(blank=True),
        ),
        migrations.AddField(
            model_name='reponse',
            name='ordre',
            field=models.PositiveIntegerField(default=0),
        ),
        migrations.AlterField(
            model_name='evaluation',
            name='bareme',
            field=models.FloatField(help_text='Note maximale possible'),
        ),
        migrations.AlterField(
            model_name='question',
            name='evaluation',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='questions', to='evaluations.evaluation'),
        ),
        migrations.AlterField(
            model_name='question',
            name='quiz',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='questions', to='evaluations.quiz'),
        ),
        migrations.AlterField(
            model_name='question',
            name='type_question',
            field=models.CharField(choices=[('choix_unique', 'Choix unique (QCM)'), ('choix_multiple', 'Choix multiple (QCM)'), ('texte_court', 'Réponse textuelle courte'), ('texte_long', 'Réponse textuelle longue (dissertation)'), ('fichier', 'Réponse en fichier'), ('texte_ou_fichier', 'Réponse textuelle ou fichier')], max_length=30),
        ),
        migrations.AlterField(
            model_name='reponse',
            name='est_correcte',
            field=models.BooleanField(default=False, help_text='Indique si cette réponse est correcte'),
        ),
        migrations.AlterField(
            model_name='reponse',
            name='question',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reponses_predefinies', to='evaluations.question'),
        ),
        migrations.CreateModel(
            name='PassageEvaluation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('statut', models.CharField(choices=[('en_cours', 'En cours'), ('soumis', 'Soumis'), ('corrige', 'Corrigé')], default='en_cours', max_length=20)),
                ('reponse_texte', models.TextField(blank=True, help_text='Réponse textuelle (pour évaluation simple)')),
                ('fichier_reponse', models.FileField(blank=True, help_text='Fichier réponse (pour évaluation simple)', null=True, upload_to='evaluations/reponses/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'docx', 'doc', 'txt', 'zip', 'jpg', 'jpeg', 'png'])])),
                ('note', models.FloatField(blank=True, help_text='Note finale obtenue', null=True)),
                ('commentaire_enseignant', models.TextField(blank=True, help_text="Commentaire général de l'enseignant")),
                ('date_debut', models.DateTimeField(auto_now_add=True)),
                ('date_soumission', models.DateTimeField(blank=True, null=True)),
                ('date_correction', models.DateTimeField(blank=True, null=True)),
                ('apprenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evaluations_passees', to='users.apprenant')),
                ('evaluation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='passages', to='evaluations.evaluation')),
            ],
            options={
                'verbose_name': "Passage d'évaluation",
                'verbose_name_plural': "Passages d'évaluations",
                'ordering': ['-date_debut'],
                'unique_together': {('apprenant', 'evaluation')},
            },
        ),
        migrations.CreateModel(
            name='PassageQuiz',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('score', models.FloatField(default=0.0)),
                ('date_passage', models.DateTimeField(auto_now_add=True)),
                ('termine', models.BooleanField(default=False)),
                ('apprenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quiz_passes', to='users.apprenant')),
                ('quiz', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='passages', to='evaluations.quiz')),
            ],
            options={
                'verbose_name': 'Passage de quiz',
                'verbose_name_plural': 'Passages de quiz',
                'ordering': ['-date_passage'],
            },
        ),
        migrations.CreateModel(
            name='ReponseQuestion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('statut', models.CharField(choices=[('non_repondu', 'Non répondu'), ('repondu', 'Répondu'), ('corrige', 'Corrigé')], default='non_repondu', max_length=20)),
                ('reponse_texte', models.TextField(blank=True, help_text="Réponse textuelle de l'apprenant")),
                ('fichier_reponse', models.FileField(blank=True, help_text="Fichier réponse de l'apprenant", null=True, upload_to='questions/reponses/%Y/%m/', validators=[django.core.validators.FileExtensionValidator(allowed_extensions=['pdf', 'docx', 'doc', 'txt', 'zip', 'jpg', 'jpeg', 'png'])])),
                ('points_obtenus', models.FloatField(default=0.0, help_text='Points obtenus pour cette question')),
                ('commentaire_correcteur', models.TextField(blank=True, help_text='Commentaire du correcteur pour cette question')),
                ('date_reponse', models.DateTimeField(auto_now_add=True)),
                ('date_correction', models.DateTimeField(blank=True, null=True)),
                ('choix_selectionnes', models.ManyToManyField(blank=True, related_name='selections_apprenants', to='evaluations.reponse')),
                ('passage_evaluation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reponses_questions', to='evaluations.passageevaluation')),
                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reponses_apprenants', to='evaluations.question')),
            ],
            options={
                'verbose_name': 'Réponse à une question',
                'verbose_name_plural': 'Réponses aux questions',
                'ordering': ['question__ordre'],
                'unique_together': {('passage_evaluation', 'question')},
            },
        ),
        migrations.CreateModel(
            name='ReponseQuiz',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('points_obtenus', models.FloatField(default=0.0)),
                ('date_reponse', models.DateTimeField(auto_now_add=True)),
                ('choix_selectionnes', models.ManyToManyField(blank=True, related_name='selections_quiz', to='evaluations.reponse')),
                ('passage_quiz', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reponses_quiz', to='evaluations.passagequiz')),
                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reponses_quiz', to='evaluations.question')),
            ],
            options={
                'verbose_name': 'Réponse de quiz',
                'verbose_name_plural': 'Réponses de quiz',
                'unique_together': {('passage_quiz', 'question')},
            },
        ),
        migrations.DeleteModel(
            name='ApprenantEvaluation',
        ),
        migrations.DeleteModel(
            name='Solution',
        ),
    ]
